<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Listado de Clientes Únicos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="color-scheme" content="light">
<meta name="supported-color-schemes" content="light">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="https://i.ibb.co/p6Ycq6XC/Turnox-logo.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<style>
  :root { color-scheme: light only; }
  body {
    font-family: "Montserrat", sans-serif;
    background-color: #4B2E78;
    color: #fff;
    margin: 0;
    padding: 0;
    text-align: center;
    overflow-x: hidden;
    overflow-y: auto;
  }

  .hidden { display: none !important; }

  /* ====== RECTÁNGULOS ANIMADOS ====== */
  .rectangles {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
  }
  .rect {
    position: absolute;
    width: 120px;
    height: 60px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 12px;
    animation: float 20s linear infinite;
  }
  .rect:nth-child(1){ top:10%; left:-150px; animation-delay:0s; }
  .rect:nth-child(2){ top:30%; left:-200px; animation-delay:5s; }
  .rect:nth-child(3){ top:50%; left:-180px; animation-delay:10s; }
  .rect:nth-child(4){ top:70%; left:-220px; animation-delay:15s; }
  .rect:nth-child(5){ top:90%; left:-160px; animation-delay:20s; }

  @keyframes float {
    from { transform: translateX(0) rotate(0deg); }
    to   { transform: translateX(120vw) rotate(360deg); }
  }

  /* ====== LOGIN ====== */
  .login-box {
    margin-top: 120px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 16px;
    padding: 30px;
    width: 90%;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    z-index: 2;
    position: relative;
  }

  input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 8px;
    border: none;
    outline: none;
  }

  button {  
    background:#25213C; 
    color:#5F48D7; 
    border:none; 
    border-radius:12px; 
    padding:12px 16px; 
    font-weight:700; 
    cursor:pointer; 
    transition:.2s transform,.2s background; 
    font-size:15px; 
    flex:1; 
    margin-top: 10px;
  }
  button:hover{ transform:translateY(-2px); background:#ffffff25; color:#fff; }

  /* ====== TABLA ====== */
  .table-wrapper {
    margin: 100px auto 40px;
    width: 95%;
    max-width: 1000px;
    overflow-x: auto;
    border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    backdrop-filter: blur(8px);
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.2);
    z-index: 2;
    position: relative;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #5F48D7;
    border: 1px solid #ffffff40;
    border-radius: 14px;
    overflow: hidden;
  }

  th, td {
    padding: 14px 12px;
    font-size: 14px;
    text-align: left;
    white-space: nowrap;
  }

  th {
    background: #4B2E78;
    color: #5F48D7;
    font-weight: 600;
    text-transform: capitalize;
  }

  tr:nth-child(even) td { background: #ffffff15; }
  tr:hover td { background: #5F48D7; }
</style>
</head>
<body>

<!-- RECTÁNGULOS DE FONDO -->
<div class="rectangles">
  <div class="rect"></div>
  <div class="rect"></div>
  <div class="rect"></div>
  <div class="rect"></div>
  <div class="rect"></div>
</div>

<!-- LOGIN -->
<div id="login" class="login-box">
  <h2>Iniciar Sesión</h2>
  <input type="text" id="usernameInput" placeholder="Usuario">
  <input type="password" id="passwordInput" placeholder="Contraseña">
  <button onclick="login()">Ingresar</button>
</div>

<!-- CONTENIDO (oculto al inicio) -->
<div id="contenido" class="hidden">
  <div class="header-info">
    <button style="max-width: 120px; max-height: 60px;" onclick="logout()">← Cerrar sesión</button>
    <h2 class="user-pill">¡Hola! <span id="usernameDisplay"></span></h2>
  </div>
  <div id="tablaReservas"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwSHPQD3ZXVqMpPZ1E2cA9_ELs8hxScPkeEs5ReZ-_MwqZ9Wt3qvIgGy6pVk6STCebKBw/exec";

document.addEventListener("DOMContentLoaded", ()=>{
  const storedUserId = localStorage.getItem("userId");
  const storedUsername = localStorage.getItem("username");
  if(storedUserId && storedUsername){
    mostrarContenido(storedUsername);
  }
});

function login(){
  const user = document.getElementById("usernameInput").value.trim();
  const pass = document.getElementById("passwordInput").value.trim();

  if(user && pass){ 
    // acá podrías validar contra tu backend
    localStorage.setItem("userId", user+"_id");
    localStorage.setItem("username", user);
    mostrarContenido(user);
  } else {
    alert("Complete usuario y contraseña");
  }
}

function logout(){
  localStorage.clear();
  document.getElementById("contenido").classList.add("hidden");
  document.getElementById("login").classList.remove("hidden");
}

function mostrarContenido(username){
  document.getElementById("login").classList.add("hidden");
  document.getElementById("contenido").classList.remove("hidden");
  document.getElementById("usernameDisplay").textContent = username;
  cargarReservas(username);
}

async function cargarReservas(username){
  try {
    const res = await fetch(`${API_URL}?action=getTurnosUsuario&username=${username}`);
    const data = await res.json();

    let turnos = [];
    if(data.turnos && typeof data.turnos === "object"){
      Object.keys(data.turnos).forEach(profId => {
        if(Array.isArray(data.turnos[profId])){
          turnos.push(...data.turnos[profId]);
        }
      });
    }

    // clientes únicos por DNI
    const unicos = {};
    turnos.forEach(t => {
      if(t.dni){ unicos[t.dni] = t; }
    });

    renderTabla(Object.values(unicos));
  } catch (e) {
    console.error(e);
    document.getElementById("tablaReservas").innerHTML = "<p>Error al cargar reservas.</p>";
  }
}

function renderTabla(turnos){
  const cont = document.getElementById("tablaReservas");
  if(turnos.length === 0){
    cont.innerHTML = "<p>No hay clientes para mostrar.</p>";
    return;
  }

  const excluir = ["extra1", "extra2", "extra3", "username", "profesional", "profesionalId", "fecha", "hora", "telefono", "fechaNacimiento", "comentario"];
  let claves = Object.keys(turnos[0]).filter(k => !excluir.includes(k));

  let html = '<div class="table-wrapper"><table><tr>';
  claves.forEach(key => { html += `<th>${key}</th>`; });
  html += "</tr>";

  turnos.forEach(t=>{
    html += "<tr>";
    claves.forEach(key=>{ html += `<td>${t[key] ?? ""}</td>`; });
    html += "</tr>";
  });

  html += "</table></div>";
  cont.innerHTML = html;
}
</script>

</body>
</html>



