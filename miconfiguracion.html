<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>TurnoX ‚Äì Configurar disponibilidad (Lun‚ÄìDom)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="https://i.ibb.co/p6Ycq6XC/Turnox-logo.png">

  <style>
    :root{ --morado:#533482; --morado-osc:#452a7a; --claro:#F4EDFF; --gris:#e7e7e7; --texto:#2b2b2b; --ok:#fff; --err:#d93636; --blanco:#ffffff; }
    *{box-sizing:border-box}
    body{ margin:0; padding:14px; font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--morado); color:#fff; }
    h1{ margin:0 0 10px 0; text-align:center; font-size:22px}
    .topbar{display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px; margin-bottom:12px}
    .note{opacity:.95; font-size:14px; background:#25213C; color:#5F48D7;}
    button{  background:#25213C; color:#5F48D7; border:none; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; transition:.2s transform,.2s background; font-size:15px; flex:1; }
    button:hover{ transform:translateY(-2px); background:#ffffff25; color:#fff; }
    button[disabled]{ opacity:.6; cursor:not-allowed; transform:none; font-family:Montserrat, }
    .profesional{ border:1px solid #ffffff30; background:#ffffff15; border-radius:14px; padding:14px; margin:12px 0; backdrop-filter: blur(3px); }
    .profesional h3{ margin:0 0 10px 0; font-size:18px; text-align:center;  }
    .actions{ display:flex; flex-wrap:wrap; gap:10px; margin-top:8px }
    .editor{ margin-top:12px; background:#ffffff15; color:#fff; border-radius:16px; padding:12px; backdrop-filter: blur(6px);
    border: 1px solid #ffffff40;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
           }
    .toolbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .toolbar .left, .toolbar .right{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    select, input[type=time], input[type=text]{ padding:10px 12px; border:1px solid var(--gris); border-radius:10px; font-weight:600; background:#fff; color:var(--texto); font-size:15px; }
    .week{ display:grid; gap:12px; grid-template-columns:repeat(2,1fr); }
    @media (max-width:640px){ .week{ grid-template-columns:1fr } }
    .day{ border:1px solid var(--gris); border-radius:12px; padding:12px; background:#ffffff15; }
    .day h4{ font-family:Montserrat, margin:0 0 10px 0; color:var(--morado); font-size:16px }
    .range{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:10px }
    .slots{ display:flex; flex-wrap:wrap; gap:8px }
    .slot{ padding:8px 12px; border-radius:10px; border:1px solid var(--gris); font-weight:700; font-size:14px; background:#eee; color:#666; cursor:pointer; user-select:none; transition:.15s; }
    .slot.selected{ background:var(--morado); color:#fff; border-color:var(--morado) }
    .mini{ font-size:12px; opacity:.8; margin-left:4px }
    .footerBar { position: fixed; top: 200px; left: 50%; transform: translate(-50%, -50%); display: flex; justify-content: center; background: #25213C; color: #fff; padding: 15px 25px; border-radius: 12px; z-index: 9999; font-size: 18px; }
    .status{ margin-top:10px; text-align:center; font-size:14px }
    .status.ok{ color:var(--ok) }
    .status.err{ color:var(--err) }
    .btn-link{  background:#25213C; color:#5F48D7; border:1px dashed var(--morado); font-size:13px; padding:8px 12px }
    .btn-danger{  background:#25213C; color:#5F48D7; border:none; }
    .pill{ padding:5px 10px; border-radius:999px; font-size:12px; background:#ffffff25; border:1px solid #ffffff40 }
    .guardar-btn{ background:#25213C; color:#5F48D7; font-size:16px!important; padding:14px!important; border-radius:14px!important; width:100%; }
    .guardar-btn:hover{ background: #ffffff25; }
    /* Loader */
    #loaderOverlay{ position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.65); display:none; align-items:center; justify-content:center; flex-direction:column; z-index:9999; color:#fff; font-size:16px; font-weight:600; text-align: center; }
    .spinner{ border:6px solid #ffffff40; border-top:6px solid var(--blanco); border-radius:50%; width:60px; height:60px; animation:spin 1s linear infinite; margin-bottom:14px; }
    @keyframes spin{ from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
    .grid { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; gap: 30px; justify-content: center; align-items: center; z-index: -1; pointer-events: none; }
    .col { display: flex; flex-direction: column; gap: 20px; }
    .rect { width: 80px; height: 120px; border: 2px solid #5F48D750; border-radius: 12px; }
    .rect.filled { background: #412866; }
    .down .rect { animation: moveDown 20s linear infinite; }
    .up .rect { animation: moveUp 20s linear infinite; }
    @keyframes moveDown { 0%{ transform: translateY(-150vh); opacity:0;} 10%{opacity:1;} 100%{transform:translateY(150vh); opacity:0;} }
    @keyframes moveUp { 0%{ transform: translateY(150vh); opacity:0;} 10%{opacity:1;} 100%{transform:translateY(-150vh); opacity:0;} }
    [hidden] { display: none !important; }
  </style>
</head>
<body>

  <div class="grid"> ... </div>
  <div class="topbar">
    <button style="max-width: 120px; max-height: 60px;" onclick="window.location.href='/creditos'">‚Üê Volver</button>
    <div class="note pill" style="color:#fff;">¬°Hola! <b id="who">‚Äî</b></div>
  </div>

  <div class="actions">
    <button id="addProfBtn">+ Agregar Profesional</button>
  </div>

  <div id="profesionales"></div>

  <!-- Loader -->
  <div id="loaderOverlay"><div class="spinner"></div><div id="loaderText">Cargando‚Ä¶</div></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxBAuhqWsLFXN9HLfXvEhh8VEEcD9ppCEmQPkhhh0LxWwjdVnoMMMMPh1gndgwTD3ZnWQ/exec";
    let userId = localStorage.getItem("userId");
    let username = localStorage.getItem("username");
    const dias = ["Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado","Domingo"];
    document.getElementById("addProfBtn").onclick = agregarProfesional;

    // Loader
    function showLoader(txt="Cargando‚Ä¶"){ document.getElementById("loaderText").textContent=txt; document.getElementById("loaderOverlay").style.display="flex"; }
    function hideLoader(){ document.getElementById("loaderOverlay").style.display="none"; }

    // Agregar Profesional + Productos
    async function agregarProfesional(){
      if(!userId){ alert("Falta userId."); return; }
      const nombre = prompt("Nombre del profesional:"); if(!nombre) return;

      // formulario inline para productos
      const cont = document.createElement("div");
      cont.innerHTML = `
        <h3>Servicios de ${nombre}</h3>
        <div id="serviciosInputs"></div>
        <button onclick="addServicioInput()">+ Agregar Servicio</button>
        <button onclick="guardarProfesional('${nombre}')">Guardar Profesional</button>
      `;
      document.body.appendChild(cont);
      window.addServicioInput = function(){
        const durs = [15,30,45,60,75,90,105,120];
        const select = durs.map(m=>`<option value="${m}">${m<60?m+' min':Math.floor(m/60)+'h'+(m%60?':'+(m%60):'')}</option>`).join("");
        const div = document.createElement("div");
        div.innerHTML = `<input type="text" placeholder="Nombre servicio"> <select>${select}</select>`;
        document.getElementById("serviciosInputs").appendChild(div);
      }
      window.guardarProfesional = async function(nombre){
        const servicios = [];
        document.querySelectorAll("#serviciosInputs div").forEach(div=>{
          const s = div.querySelector("input").value;
          const t = div.querySelector("select").value;
          if(s) servicios.push({nombre:s, tiempo:t});
        });
        showLoader("Creando profesional‚Ä¶");
        try{
          const fd = new FormData();
          fd.append("action","addProfessional");
          fd.append("userId",userId);
          fd.append("nombre",nombre);
          fd.append("servicios",JSON.stringify(servicios)); // üîπ guardo servicios
          const res = await fetch(API_URL,{method:"POST",body:fd});
          const data = await res.json();
          hideLoader();
          if(data.status==="ok") cargarProfesionales();
          else alert("No se pudo agregar");
        }catch(e){ hideLoader(); alert("‚ö†Ô∏è Error de conexi√≥n"); }
      }
      addServicioInput(); // arranco con 1 campo
    }

    async function cargarProfesionales(){ /* igual que antes */ }
    function renderProfesionales(list){ /* igual que antes */ }
    function abrirEditor(editorEl, prof){ /* igual que antes */ }
    function generarSlots(){/* igual que antes */ }
    function generarTodos(){/* igual que antes */ }
    function seleccionarTodo(){/* igual que antes */ }
    async function guardarTurnos(){/* igual que antes */ }
    async function eliminarTurnos(){/* igual que antes */ }
    async function eliminarProfesional(){/* igual que antes */ }

    document.addEventListener("DOMContentLoaded", ()=>{ if(username) document.getElementById("who").textContent=username; cargarProfesionales(); });
  </script>
</body>
</html>
