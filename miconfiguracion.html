<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>TurnoX - Configuraci√≥n de Turnos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --morado:#533482;
      --claro:#F4EDFF;
      --gris:#e7e7e7;
      --texto:#2b2b2b;
    }
    body{
      margin:0; padding:24px;
      font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--morado);
      color:#fff;
    }
    .topbar{display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
    h1{margin:0;font-size:22px;}
    button{
      background:#fff; color:var(--morado);
      border:none; border-radius:10px; padding:10px 14px;
      font-weight:700; cursor:pointer;
      transition:.2s;
    }
    button:hover{background:var(--claro);}
    .week{display:grid; gap:16px; grid-template-columns:repeat(4,1fr);}
    @media(max-width:900px){.week{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:600px){.week{grid-template-columns:1fr}}
    .day{
      background:#ffffff10; border:1px solid #ffffff30;
      border-radius:14px; padding:14px;
    }
    .day h2{margin:0 0 6px 0; font-size:18px;}
    .slots{display:flex; flex-wrap:wrap; gap:8px;}
    .slot{
      padding:6px 10px; border-radius:8px;
      border:1px solid var(--gris); font-weight:700; font-size:13px;
      background:#fff; color:var(--texto); cursor:pointer;
      user-select:none;
    }
    .slot.off{background:#ccc; color:#666; text-decoration:line-through;}
  </style>
</head>
<body>
  <div class="topbar">
    <h1>Configuraci√≥n de Turnos</h1>
    <button id="saveBtn">üíæ Guardar</button>
  </div>
  <div id="week" class="week"></div>
  <div id="msg"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxpL3trtn3QD08UTOBR2ToRNb-UouL0PfiuNjJhDCCcZ-f0UqAacugvHRbgwKQVfHZhfw/exec"; // ‚ö†Ô∏è cambia por tu endpoint
    const username = new URLSearchParams(window.location.search).get("username") || "demo";

    const diasOrden = ["Lunes","Martes","Mi√©rcoles","Jueves","Viernes","Sabado","Domingo"];
    let turnos = {}; // estructura: { "Lunes": { "09:00":"1", "10:00":"0", ... }, ... }

    function render(){
      const weekDiv = document.getElementById("week");
      weekDiv.innerHTML = "";
      diasOrden.forEach(dia=>{
        const dayBox = document.createElement("div");
        dayBox.className="day";
        dayBox.innerHTML = `<h2>${dia}</h2>`;
        const slotsDiv = document.createElement("div");
        slotsDiv.className="slots";

        if(turnos[dia]){
          Object.keys(turnos[dia]).forEach(hora=>{
            const estado = turnos[dia][hora];
            const slot = document.createElement("div");
            slot.className = "slot " + (estado==="1" ? "" : "off");
            slot.textContent = hora;
            slot.onclick=()=>{
              turnos[dia][hora] = (turnos[dia][hora]==="1") ? "0" : "1";
              render();
            };
            slotsDiv.appendChild(slot);
          });
        } else {
          slotsDiv.innerHTML = "<em>No hay horarios configurados</em>";
        }

        dayBox.appendChild(slotsDiv);
        weekDiv.appendChild(dayBox);
      });
    }

    async function load(){
      try{
        const res = await fetch(`${API_URL}?action=getTurnosStandard&username=${encodeURIComponent(username)}`);
        const data = await res.json();
        if(data.status==="ok"){
          // data.turnos = { "Lunes":[{hora:"09:00",estado:"1"},...], ... }
          turnos = {};
          for(const dia in data.turnos){
            turnos[dia] = {};
            data.turnos[dia].forEach(slot=>{
              turnos[dia][slot.hora] = slot.estado;
            });
          }
        }
      }catch(e){ console.error(e); }
      render();
    }

    document.getElementById("saveBtn").onclick = async ()=>{
      try{
        const res = await fetch(API_URL,{
          method:"POST",
          body:JSON.stringify({action:"guardarTurnos",username,turnos})
        });
        const data = await res.json();
        document.getElementById("msg").textContent = "‚úî Guardado!";
      }catch(e){
        document.getElementById("msg").textContent = "‚ùå Error al guardar";
      }
    };

    load();
  </script>
</body>
</html>
